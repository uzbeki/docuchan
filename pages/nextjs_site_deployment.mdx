# Nextjs Deployment
NextJSã§ä½œã‚‰ã‚ŒãŸã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ã€ã„ãã¤ã‹ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã§ã¯ã€ä»¥ä¸‹ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ï¼š
ğŸ“– Docs: https://nextjs.org/docs/pages/building-your-application/deploying

## ç°¡å˜ãªæ–¹æ³•ï¼šVercel - beginner
Vercelã¯NextJSã®å…¬å¼ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã§ã€ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚Githubãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã¨é€£æºã—ã¦ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚å¯èƒ½ã§ã™ã€‚
Docs: https://vercel.com/docs/frameworks/nextjs  
ğŸ“Ÿ Live Demo: 

### Requirements
- Githubã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
- Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

### Steps
1. Githubãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚
2. Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
3. Vercelã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã€Githubãƒªãƒã‚¸ãƒˆãƒªãƒ¼ã‚’é€£æºã—ã¾ã™ã€‚

æ¬¡ã¯ã€ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®šã€ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãªã©ã‚’è¡Œã„ã¾ã™ã€‚ãã“ã¯é£›ã°ã—ã¾ã™ã€‚è‡ªåˆ†ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ç°¡å˜ã™ãã§ã‚ã‚“ã¾ã‚Šå‹‰å¼·ã«ãªã‚‰ãªã„ã®ã§ã€æ¬¡ã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## Deploying to VM - intermediate
ã„ã¤ã‚‚ã®ã‚ˆã†ã«ã€AWSã‹ã‚‰EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
nginxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚’è¨­å®šã—ã¾ã™ã€‚
ãã®å¾Œã€NextJSã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã€nginxã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚

### Create EC2 Instance
- AMI: Ubuntu Server 20.04 LTS (HVM), SSD Volume Type
- Instance Type: t2.micro
- Security Group: HTTP, HTTPS, SSH

### Connect to EC2 Instance
```bash
ssh -t ubuntu@<your-ec2-public-ip>
```

### Install Nginx
```bash
sudo apt update && sudo apt upgrade -y && sudo apt install nginx -y
```

### Install NodeJS
```bash
# https://github.com/nodesource/distributions/blob/master/README.md#using-ubuntu-1
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - &&\
sudo apt-get install -y nodejs
```

### Configure Nginx
```bash
sudo nano /etc/nginx/sites-available/default
```

```nginx
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    server_name _;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
    }

}
```


### Build NextJS App
```bash
npm run build
npm run start
```

### Restart Nginx
```bash
sudo systemctl restart nginx
```

### Done
Now you can access your NextJS app at `http://<your-ec2-public-ip>`

### pm2
### Install PM2
```bash
sudo npm install pm2 -g
```
### Start NextJS App
```bash
pm2 start npm --name "nextjs" -- start
```

## Standalone build - advanced
NextJSã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã€é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã“ã‹ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã‚‹ã ã‘ã§ã™ã€‚

### nextConfig ã‚’è¨­å®š
Docs: https://template.nextjs.guide/app/api-reference/next-config-js/output
```js
module.exports = {
  output: 'standalone',
}https://github.com/uzbeki/docuchan.git
```https://github.com/uzbeki/docuchan.git